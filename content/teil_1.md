# Praktikumsbericht

## Grundgerüst

Basierend auf Processing und dem Simple Multi-Touch(SMT) Toolkit für Processing entstand das Grundgerüst für das Bomberman Spiel. Als Einstiegspunkt für die graphische Anwendung muss die Klasse `PApplet` aus Processing erweitert werden. Die Implementierung erfolgt in der Klasse `Field`, zudem muss diese Klasse zwei Methoden implementieren. Zum einen die `setup`-Methode, in der alle Rahmenbedingungen zur Erstellung der Anwendung definiert werden und zum anderen die `draw`-Methode, die kontinuierlich vom Framework aufgerufen wird um die graphische Anzeige zu generieren. Zusätzlich liest der Konstruktor der Klasse bereits die Einstellungen aus einer `properties`-Datei ein und er erstellt eine Hashmap mit allen verwendeten Bildern, um auf diese später ohne zusätzliche Dateizugriffe zuzugreifen.

In der `setup`-Methode wird als erstes die Auflösung der Anwendung und gleichzeitig die Rendering Engine definiert. Letzte wird auf `SMT.RENDERER` festgelegt, um das SMT-Framework benutzen zu können. Die Auflösung für die Anwendung wurde während des Entwicklungsprozesses fest definiert. Für den produktiven Einsatz, lässt sich die Auflösung mittels der Varibalen `this.displayWidth` und `this.displayHeight` an die Auflösung des Bildschirmes anpassen.

Die Methode initialisiert des weiteren das Spielfeld, ein Raster von Blöcken, auf denen sich die Spielfiguren bewegen. Der Abschnitt "Spielfeld" beschreibt die Details dazu genauer. Neben dem Spielfeld werden auch die Bereiche für die Steurung für die Nutzer angelegt, die so genannte `UserArea`. Diese Klasse, die von der SMT-Klasse `Zone` erbt, wird für jeden Spieler angelegt. Jeder `UserArea` wird direkt eine Spielfigur, eine Instanz der `Bomberman`-Klasse zugeordnet. Der Nutzer kann über die Steuerungsmöglichkeiten der `UserArea` direkt mit seiner Spielfigur interagieren. Um das Spiel für vier Spieler zugänglich zu machen, sind jeweils zwei Steuerungen auf der langen Seite des Bildschirmes positioniert. Die weiteren zwei Steuerungen befinden sich gespiegelt an der gegenüberliegenden Seite des Bildschirmes.

### Spielfeld

Das grundlegende Spielfeld wird über die Klasse `Blocks` dargestellt. Die Klasse verwaltet das zweidimensionale Blockraster, in dem sich die Spielfiguren bewegen und ihre Aktionen ausführen.
Jeder einzellne Block gehört zu der gleichnamigen Klasse. Die Blöcke untergliedern sich in verschiedene Typen: verdeckter Block, leerer Block, Block mit Gegenstand, statischer Block, Block mit Bombe.
Auf leeren Blöcken kann der Nutzer die Spielfigur bewegen. Beim Start des Spieles existieren leere Blöcke um die Startposition der Spielfigur herum. Von dieser Startposition aus muss der Nutzer die verdeckten Blöcke wegsprengen, um sich weiter durch das Spielfeld bewegen zu können. Das Sprengen erfolgt durch das Legen einer Bombe. Der Block im Raster, in dem die Bombe gelegt wurde, wird als Block mit Bombe dargestellt und animiert. Nun hat der Spieler rund 3 Sekunden Zeit um seine Spielfigur aus dem Sprengradius der Bombe zu bewegen um zu überleben. Wird ein verdeckter Block verstört, kommt entweder ein Block mit einem Gegenstand oder ein leerer Block zum vorschein. Die Verteilung der Gegenstände unter den verdeckten Blöcken erfolgt zufällig. Dabei verteilt der Algorithmus im Bereich um die Startposition der einzelnen Figuren mehr Gegenstände als in der Mitte des Spielfelden. Neben den sprengbaren Blöcken existieren die statischen Blöcke. Sie werden über das Raster so verteilt, dass zwischen diesen immer ein leerer oder verdeckter Block liegt.

Ein einzellner Block wird in der gleichnamigen Klasse durch das Processing Element `PShape` dargestellt. Die größe eines Blockes berechnet sich dynamisch anhand der Displaygröße und der Dimensionen des Spielfeldes. Dadurch skaliert das Blockraster mit der Auflösung des Bildschirmes.
Der Type des Blockes wird über sein Attribut `type` festgelegt. Anhand dieses Types wird der Block mit einer bestimmten Textur angezeigt. Mit Settern und Gettern, können zudem vom Block weitere Attribute abgefragt und gesetzt werden. So ist es für die Bewegung der Spielfigur wichtig, ob diese sich auf einen bestimmten Block bewegen darf oder nicht. Die Methode `isWalkable` berechnet diese Eigenschaft aus dem Typen des Blockes und ob dieser verdeckt ist.

### Bewegung der Spielfigur

Die Spielfiguren werdem vom Spieler über die `UserArea` gesteuert. Der Spieler hat die Möglichkeit seine Figur innerhalb des Blockrasters auf den begebaren Blöcken zu bewegen. Dabei kann die Bewegung in vier Richtungen erfolgen: oben, unten, links und rechts.

Die Eingabe über die `UserArea` ruft die Bewegungsmethoden in der Klasse `Bomberman` auf. In dieser Klasse existiert eine eindeutige Zuordnung zu einer Koordinate im Blockraster und somit eine eindeutige Zuordnung zum Spielfeld. Mit jeder Bewegung der Spielfigur wird diese Rasterzuordnung neu berechnet. Der Spieler bewegt seine Spielfigur Pixelweise horizontal und vertikal durch die Bewegungsmethoden. Die Figur bewegt sich dabei auf virtuellen Linien, die die Mittelpunkte der Blöcke miteinander verbinden. Mit jedem Frame wird überprüft, ob die Spielfigur sich zu einem weiteren Block bewegen kann. Dabei wird überprüft, ob sich der Rand der Spielfigur in einen Block bewegt, der betreten werden darf. Darf dieser Block nicht betreten werden, so kann sich die Spielfigur in Richtung dieses Blocks nicht weiter bewegen. Die Abfrage beschränkt sich zudem auf die der Spielfigur direkt angrenzenden Blöcke oder den Spielfeldrand.

Durch die Bewegung auf der virtuelen Linie, müsste sich die Spielfigur direkt im Mittelpunkt eines Blockes befinden, um von einer vertikalen in eine horizontale Bewegung, oder umgekehrt, überzugehen. Mit Hilfe eines Tolleranzberieches um den Mittelpunkt des Blockes herum, kann die Spielfigur zwischen einer vertikalen und horizontalen Linie übergehen. Ein zu kleiner Tolleranzbereich hemmt dabei aber den Spielfluss, da es für den Spieler zu schwierig ist seine Figur in diesen Bereich zu steuern.
